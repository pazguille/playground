/**
  * Chico-UI
  * Packer-o-matic
  * Like the pizza delivery service: "Les than 100 milisecons delivery guarantee!"
  * @components: core, positioner, object, floats, navs, controllers, watcher, sliders, carousel, dropdown, layer, modal, tabNavigator, tooltip, string, number, custom, required, helper, form, viewer, chat, expando, codelighter, accordion
  * @version 0.4
  * @autor Chico Team <chico@mercadolibre.com>
  *
  * @based on:
  * JSMin
  * @author Ryan Grove <ryan@wonko.com> 
  * @copyright 2002 Douglas Crockford <douglas@crockford.com> (jsmin.c) 
  * @copyright 2008 Ryan Grove <ryan@wonko.com> (PHP port) 
  * @link http://code.google.com/p/jsmin-php/ 
  */
;(function($){

var start=new Date().getTime();var ch=window.ch={version:"0.5.9",components:"carousel,dropdown,layer,modal,tabNavigator,tooltip,string,number,custom,required,helper,form,viewer,chat,expando,codelighter,accordion",internals:"positioner,object,floats,navs,controllers,watcher,sliders",instances:{},features:{},init:function(){$("html").removeClass("no-js");ch.features=ch.support();ch.components=(window.components)?ch.components+","+window.components:ch.components;ch.internals=(window.internals)?ch.internals+","+window.internals:ch.internals;$(ch.components.split(",")).each(function(i,e){ch.factory({component:e});});},utils:{body:$('body'),html:$('html'),window:$(window),document:$(document),zIndex:1000,index:0,isSelector:function(string){if(typeof string!=="string")return false;for(var regex in $.expr.match){if($.expr.match[regex].test(string)&&$(string).length>0){return true;};};return false;},isUrl:function(url){return((/^((https?|ftp|file):\/\/|((www|ftp)\.)|(\/|.*\/)*)[a-z0-9-]+((\.|\/)[a-z0-9-]+)+([/?].*)?$/).test(url));}},events:{CHANGE_LAYOUT:"changeLayout"}};ch.preload=function(arr){if(typeof arr==="string"){arr=(arr.indexOf(",")>0)?arr.split(","):[arr];}
for(var i=0;i<arr.length;i++){var o=document.createElement("object");o.data=arr[i];var h=document.getElementsByTagName("head")[0];h.appendChild(o);h.removeChild(o);}};ch.factory=function(o){if(!o){alert("Factory fatal error: Need and object {component:\"\"} to configure a component.");return;};if(!o.component){alert("Factory fatal error: No component defined.");return;};var x=o.component;var create=function(x){$.fn[x]=function(options){var results=[];var that=this;var _arguments=arguments;that.each(function(i,e){var conf=options||{};var context={};context.type=x;context.element=e;context.$element=$(e);context.uid=ch.utils.index+=1;switch(typeof conf){case"number":var num=conf;conf={};conf.value=num;if(_arguments[1]){conf.msg=_arguments[1];};break;case"string":var msg=conf;conf={};conf.msg=msg;break;case"function":var func=conf;conf={};conf.lambda=func;if(_arguments[1]){conf.msg=_arguments[1];};break;};var created=ch[x].call(context,conf);created=(created.hasOwnProperty("public"))?created.public:created;if(created.type){var type=created.type;if(!ch.instances[type]){ch.instances[type]=[];}
ch.instances[type].push(created);}
if(created.exists){created=created.object;}
results.push(created);});return(results.length>1)?results:results[0];};if(o.callback){o.callback();}}
if(ch[o.component]){create(o.component);}else{ch.get({"method":"component","component":o.component,"script":(o.script)?o.script:"src/js/"+o.component+".js","styles":(o.style)?o.style:"src/css/"+x+".css","callback":create});}}
ch.get=function(o){switch(o.method){case"content":var that=o.that;var conf=that.conf;var context=(that.controller)?that.controller.public:that.public;$.ajax({url:conf.ajaxUrl,type:conf.ajaxType||'GET',data:conf.ajaxParams,cache:true,async:true,success:function(data,textStatus,xhr){that.$content.html(data);if(conf.onContentLoad)conf.onContentLoad.call(context);if(conf.position)ch.positioner(conf.position);},error:function(xhr,textStatus,errorThrown){data=(conf.hasOwnProperty("onContentError"))?conf.onContentError.call(context,xhr,textStatus,errorThrown):"<p>Error on ajax call </p>";that.$content.html(data);if(conf.position)ch.positioner(conf.position);}});break;case"component":if(o.style){var style=document.createElement('link');style.href=o.style;style.rel='stylesheet';style.type='text/css';}
if(o.script){var script=document.createElement("script");script.src=o.script;}
var head=document.getElementsByTagName("head")[0]||document.documentElement;var done=false;script.onload=script.onreadystatechange=function(){if(!done&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){done=true;if(o.callback){o.callback(o.component);}
script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script);}}};if(o.script){head.insertBefore(script,head.firstChild);}
if(o.style){head.appendChild(style);}
break;}}
ch.eraser=function(data){if(typeof data=="number"){for(var x in ch.instances){var component=ch.instances[x];for(var i=0,j=component.length;i<j;i+=1){if(component[i].uid==data){delete component[i];component.splice(i,1);return;};};};}else{if(data==="meltdown"){delete ch.instances;ch.instances={};}else{for(var x in ch.instances){if(x==data){var component=ch.instances[x];delete ch.instances[x];};};};};};ch.support=function(){var transition=(function(){var thisBody=document.body||document.documentElement;var thisStyle=thisBody.style;return thisStyle.WebkitTransition!==undefined||thisStyle.MozTransition!==undefined||thisStyle.OTransition!==undefined||thisStyle.transition!==undefined;})();return{transition:transition};};ch.cache={map:{},add:function(url,data){ch.cache.map[url]=data;},get:function(url){return ch.cache.map[url];},rem:function(url){ch.cache.map[url]=null;delete ch.cache.map[url];},flush:function(){delete ch.cache.map;ch.cache.map={};}};ch.clon=function(o){obj={};for(x in o){obj[x]=o[x];};return obj;};$(function(){var now=new Date().getTime();ch.loadTime=now-start;});ch.positioner=function(o){var o=o||this.conf.position;var element=$(o.element);element.css("position","absolute");var context;var viewport;var parentRelative;o.points=o.points||"cm cm";o.offset=o.offset||"0 0";var classReferences={"lt lb":"down","lb lt":"top","rt rb":"down","rb rt":"top","lt rt":"right","cm cm":"center"};var splittedOffset=o.offset.split(" ");var offset_left=parseInt(splittedOffset[0]);var offset_top=parseInt(splittedOffset[1]);var getViewport=(typeof window.innerWidth!="undefined")?function getViewport(){var viewport,width,height,left,top,pageX,pageY,scrollBar=30;viewport=window;width=viewport.innerWidth-scrollBar;height=viewport.innerHeight;pageX=viewport.pageXOffset;pageY=viewport.pageYOffset;return{element:viewport,left:0+offset_left+pageX-scrollBar,top:0+offset_top+pageY,bottom:height+pageY,right:width+pageX,width:width,height:height}}:function getViewport(){var viewport,width,height,left,top,pageX,pageY,scrollBar=30;viewport=document.documentElement;width=viewport.clientWidth-scrollBar;height=viewport.clientHeight;pageX=viewport.scrollLeft;pageY=viewport.scrollTop;return{element:viewport,left:0+offset_left+pageX,top:0+offset_top+pageY,bottom:height+pageY,right:width+pageX,width:width,height:height}};var getPosition=function(unitPoints){var contextLeft=context.left;var contextTop=context.top;var contextWidth=context.width;var contextHeight=context.height;var elementWidth=element.outerWidth();var elementHeight=element.outerHeight();var xReferences={ll:contextLeft,lr:contextLeft+contextWidth,rr:contextLeft+contextWidth-elementWidth,cc:contextLeft+contextWidth/2-elementWidth/2}
var yReferences={tt:contextTop,tb:contextTop+contextHeight,bt:contextTop-elementHeight,mm:contextTop+contextHeight/2-elementHeight/2}
var axis={left:xReferences[unitPoints.my_x+unitPoints.at_x],top:yReferences[unitPoints.my_y+unitPoints.at_y]}
return axis;};var calculatePoints=function(points,unitPoints){var styles=getPosition(unitPoints);styles.direction=classReferences[points];if(o.hold)return styles;if((points=="lt lb")&&((styles.top+parentRelative.top+element.outerHeight())>viewport.bottom)){unitPoints.my_y="b";unitPoints.at_y="t";stylesDown=styles;styles=getPosition(unitPoints);styles.direction="top";styles.top-=(2*offset_top);if(styles.top+parentRelative.top<viewport.top){unitPoints.my_y="t";unitPoints.at_y="b";styles=stylesDown;styles.direction="down";};};if((styles.left+parentRelative.left+element.outerWidth())>viewport.right){unitPoints.my_x="r";unitPoints.at_x="r";stylesLeft=styles;var current=styles.direction;styles=getPosition(unitPoints);styles.direction=current+"-right";styles.left-=(2*offset_left);if(current=="top")styles.top-=(2*offset_top);if(styles.left<viewport.left){unitPoints.my_y="l";unitPoints.at_y="l";styles=stylesLeft;};};return styles;};var setPosition=function(){var splitted=o.points.split(" ");var unitPoints={my_x:splitted[0].slice(0,1),my_y:splitted[0].slice(1,2),at_x:splitted[1].slice(0,1),at_y:splitted[1].slice(1,2)}
var styles=calculatePoints(o.points,unitPoints);element.css({left:styles.left,top:styles.top}).removeClass("ch-top ch-left ch-down ch-right ch-down-right ch-top-right  ch-right-right").addClass("ch-"+styles.direction);if(context.hasOwnProperty("element")&&context.element!==ch.utils.window[0]){$(context.element).removeClass("ch-top ch-left ch-down ch-right ch-down-right ch-top-right ch-right-right").addClass("ch-"+styles.direction);};};var getContext=(o.context)?function getContext(){var contextOffset=o.context.offset();context={element:o.context,top:contextOffset.top+offset_top-parentRelative.top,left:contextOffset.left+offset_left-parentRelative.left,width:o.context.outerWidth(),height:o.context.outerHeight()};return context;}:function getContext(){return viewport;};var getParentRelative=function(){var relative={};relative.left=0;relative.top=0;var parent=element.offsetParent();if(parent.css("position")=="relative"){var borderLeft=(parent.outerWidth()-parent.width()-(parseInt(parent.css("padding-left"))*2))/2;relative=parent.offset();relative.left-=offset_left-borderLeft;relative.top-=offset_top;};return{left:relative.left,top:relative.top};};var initPosition=function(){viewport=getViewport();parentRelative=getParentRelative();context=getContext();setPosition();};var scrolled=false;initPosition();ch.utils.window.bind("resize scroll",function(){scrolled=true;});setInterval(function(){if(!scrolled)return;scrolled=false;if(element.css("display")==="none")return;initPosition();},250);return $(element);};ch.object=function(){var that=this;var conf=that.conf;that.prevent=function(event){if(event&&typeof event=="object"){event.preventDefault();event.stopPropagation();};return that;};that.content=function(content){if(content===undefined){var content=conf.content||conf.msg;return(content)?((ch.utils.isSelector(content))?$(content):content):((conf.ajax===true)?(that.$trigger.attr('href')||that.$trigger.parents('form').attr('action')):conf.ajax);}else{conf.cache=false;if(ch.utils.isUrl(content)){conf.content=undefined;conf.ajax=content;}else{conf.ajax=false;conf.content=content;};if(that.active){that.$content.html(that.loadContent());return that.position("refresh");};if(that.active)that.position("refresh");return that.public;};};that.loadContent=function(){if(conf.ajax===true){conf.ajaxUrl=that.$element.attr('href')||that.$element.parents('form').attr('action');conf.ajaxParams='x=x';if(that.$element.attr('type')=='submit'){conf.ajaxType=that.$element.parents('form').attr('method')||'GET';var serialized=that.$element.parents('form').serialize();conf.ajaxParams=conf.ajaxParams+((serialized!='')?'&'+serialized:'');};ch.get({method:"content",that:that});return'<div class="loading"></div>';}else if(conf.ajax||(conf.msg&&ch.utils.isUrl(conf.msg))){conf.ajaxUrl=conf.ajax||conf.msg;conf.ajaxParams='x=x';ch.get({method:"content",that:that});return'<div class="loading"></div>';}else{var content=conf.content||conf.msg;return(ch.utils.isSelector(content))?$(content).detach().clone().removeClass("ch-hide").show():content;};};that.callbacks=function(when){if(conf.hasOwnProperty(when)){var context=(that.controller)?that.controller.public:that.public;return conf[when].call(context);};};that.position=function(o){switch(typeof o){case"object":conf.position.context=o.context||conf.position.context;conf.position.points=o.points||conf.position.points;conf.position.offset=o.offset||conf.position.offset;conf.position.fixed=o.fixed||conf.position.fixed;ch.positioner(conf.position);return that.public;break;case"string":if(o!="refresh"){alert("ChicoUI error: position() expected to find \"refresh\" parameter.");};ch.positioner(conf.position);return that.public;break;case"undefined":return conf.position;break;};};that.public={};return that;};ch.floats=function(){var that=this;var conf=that.conf;that=ch.object.call(that);that.parent=ch.clon(that);var createCone=function(){$("<div>").addClass("ch-cone").prependTo(that.$container);return;};var createClose=function(){$("<div>").addClass("btn close").css("z-index",ch.utils.zIndex++).bind("click",function(event){that.hide(event);}).prependTo(that.$container);return;};var createLayout=function(){that.$content=$("<div>").addClass("ch-"+that.type+"-content").html(that.loadContent());that.$container=$("<div>").addClass("ch-"+that.type).addClass("ch-hide").css("z-index",ch.utils.zIndex++).append(that.$content).appendTo("body");if(conf.classes)that.$container.addClass(conf.classes);if(conf.hasOwnProperty("width"))that.$container.css("width",conf.width);if(conf.hasOwnProperty("height"))that.$container.css("height",conf.height);if(conf.closeButton)createClose();if(conf.cone)createCone();conf.cache=(conf.hasOwnProperty("cache"))?conf.cache:true;that.$container.fadeIn("fast",function(){that.callbacks("onShow");});conf.position=conf.position||{};conf.position.element=that.$container;conf.position.hold=conf.hold||false;ch.positioner.call(that);return;};that.active=false;that.show=function(event){if(event)that.prevent(event);if(that.active)return;that.active=true;if(that.$container){if(!conf.cache)that.$content.html(that.loadContent());var content=conf.content||conf.msg;if(ch.utils.isSelector(content))$(content).detach();that.$container.appendTo("body").css("z-index",ch.utils.zIndex++).fadeIn('fast',function(){that.active=true;that.callbacks('onShow');});that.position("refresh");return that;};createLayout();return that;};that.hide=function(event){if(event)that.prevent(event);if(!that.active)return;that.$container.fadeOut('fast',function(){that.active=false;var content=conf.content||conf.msg;if(ch.utils.isSelector(content)){that.$content.children().clone().addClass("ch-hide").appendTo("body");};that.callbacks('onHide');$(this).detach();});return that;};return that;};ch.navs=function(){var that=this;var conf=that.conf;that=ch.object.call(that);that.parent=ch.clon(that);that.active=false;that.show=function(event){that.prevent(event);if(that.active)return;that.active=true;that.$trigger.addClass("ch-"+that.type+"-on");that.$content.removeClass("ch-hide");that.callbacks("onShow");return that;};that.hide=function(event){that.prevent(event);if(!that.active)return;that.active=false;that.$trigger.removeClass("ch-"+that.type+"-on");that.$content.addClass("ch-hide");that.callbacks("onHide");return that;};return that;}
ch.controllers=function(){var that=this;that=ch.object.call(that);that.parent=ch.clon(that);that.children=[];return that;};ch.watcher=function(conf){var that=this;conf=ch.clon(conf);that.conf=conf;that=ch.object.call(that);that.parent=ch.clon(that);var controller=(function(){if(ch.instances.hasOwnProperty("form")&&ch.instances.form.length>0){var i=0,j=ch.instances.form.length;for(i;i<j;i++){if(ch.instances.form[i].element===that.$element.parents("form")[0]){return ch.instances.form[i];};};}else{that.$element.parents("form").form();var last=(ch.instances.form.length-1);return ch.instances.form[last];};})();var checkInstance=function(){var instance=ch.instances.watcher;if(instance&&instance.length>0){for(var i=0,j=instance.length;i<j;i++){if(instance[i].element!==that.element)continue;$.extend(instance[i].validations,that.validations);$.extend(instance[i].conditions,that.conditions);$.extend(instance[i].messages,that.messages);instance[i].types=mergeTypes(instance[i].types);return{exists:true,object:instance[i]};};};};var mergeTypes=function(types){if(!types||types==""){return conf.types;}else{var currentTypes=types.split(",");var newTypes=conf.types.split(",");var toMerge=[];var e=0;g=newTypes.length;for(e;e<g;e++){if(types.indexOf(newTypes[e])===-1){toMerge.push(newTypes[e]);};};if(toMerge.length>0){$.merge(currentTypes,toMerge);};return currentTypes.join(",");}};var revalidate=function(){that.validate();controller.checkStatus();};that.active=false;that.enabled=true;that.reference=(function(){var reference;if(that.$element.hasClass("options")){if(that.$element.find('h4').length>0){var h4=that.$element.find('h4');h4.wrapInner('<span>');reference=h4.children();}else if(that.$element.prev().attr('tagName')=='LEGEND'){reference=that.$element.prev();}}else{reference=that.$element;}
return reference;})();that.validations=(function(){var collection={};var types=conf.types.split(",");for(var i=0,j=types.length;i<j;i++){for(var val in conf){if(types[i]==val){collection[val]=conf[val];}}}
return collection;})();that.conditions=(function(){var collection={};var types=conf.types.split(",");for(var i=0,j=types.length;i<j;i++){for(var val in conf){if(types[i]==val){collection[val]=conf.conditions[val];}}}
return collection;})();that.messages=ch.clon(conf.messages);var helper={};helper.uid=that.uid+"#0";helper.type="helper";helper.element=that.element;helper.$element=that.$element;that.helper=ch.helper.call(helper,that);that.validate=function(){if(that.$element.attr('disabled')){return;}
if(!that.validations.hasOwnProperty("required")&&that.isEmpty()){return;}
if(that.enabled){that.callbacks('beforeValidate');for(var type in that.validations){var condition=that.conditions[type];var value=that.$element.val();var gotError=false;if(type=="required"){gotError=that.isEmpty();}
if(condition.patt){gotError=!condition.patt.test(value);}
if(condition.expr){gotError=!condition.expr((type.indexOf("Length")>-1)?value.length:value,that.validations[type]);}
if(condition.func&&type!="required"){gotError=!condition.func.call(this,value);}
if(gotError){that.$element.addClass("error");var text=(that.messages.hasOwnProperty(type))?that.messages[type]:(controller.hasOwnProperty("messages"))?controller.messages[type]:undefined;that.helper.show(text);that.active=true;var event=(that.tag=='OPTIONS'||that.tag=='SELECT')?"change":"blur";that.$element.one(event,that.validate);return;}}}
if(that.active||!that.enabled){that.$element.removeClass("error");that.helper.hide();that.active=false;controller.checkStatus();}
that.callbacks('afterValidate');return that;};that.reset=function(){that.active=false;that.$element.removeClass("error");that.helper.hide();that.$element.unbind("blur");that.callbacks("onReset");return that;};that.isEmpty=function(){that.tag=(that.$element.hasClass("options"))?"OPTIONS":that.element.tagName;switch(that.tag){case'OPTIONS':return that.$element.find('input:checked').length===0;break;case'SELECT':var val=that.$element.val();return parseInt(val)===-1||val===null;break;case'INPUT':case'TEXTAREA':return $.trim(that.$element.val()).length===0;break;};};that.public.uid=that.uid;that.public.element=that.element;that.public.type="watcher";that.public.types=conf.types;that.public.reference=that.reference;that.public.validations=that.validations;that.public.conditions=that.conditions;that.public.messages=that.messages;that.public.helper=that.helper;that.public.active=function(){return that.active;};that.public.and=function(){return that.$element;};that.public.reset=function(){that.reset();return that.public;};that.public.validate=function(){that.validate();return that.public;};that.public.enable=function(){that.enabled=true;return that.public;};that.public.disable=function(){that.enabled=false;return that.public;};that.public.refresh=function(){return that.helper.position("refresh");};var check=checkInstance();if(check){var that={};that.public=check;}else{controller.children.push(that.public);};return that;};ch.sliders=function(){var that=this;var conf=that.conf;that=ch.object.call(that);that.parent=ch.clon(that);that.active=false;return that;};ch.carousel=function(conf){var that=this;that.$element.addClass('ch-carousel');if(conf.height)that.$element.height(conf.height);if(conf.width)that.$element.width(conf.width);that.$content=that.$element.find('.carousel').addClass('ch-carousel-content').wrap($('<div>').addClass('ch-mask'))
conf=ch.clon(conf);that.conf=conf;that=ch.sliders.call(that);that.parent=ch.clon(that);var page=1;var htmlElementMargin=(ch.utils.html.hasClass("ie6"))?21:20;var extraWidth=(ch.utils.html.hasClass("ie6"))?that.$content.children().outerWidth():0;var htmlContentWidth=that.$content.children().size()*(that.$content.children().outerWidth()+htmlElementMargin)+extraWidth;that.$content.css('width',htmlContentWidth);var $mask=that.$element.find('.ch-mask');var steps,totalPages,moveTo,margin;var calculateMask=function(){steps=~~((that.$element.width()-70)/(that.$content.children().outerWidth()+20));steps=(steps==0)?1:steps;totalPages=Math.ceil(that.$content.children().size()/steps);moveTo=(that.$content.children().outerWidth()+20)*steps;margin=($mask.width()-moveTo)/2;$mask.width(moveTo).height(conf.height||that.$content.children().outerHeight()+2);return that;};calculateMask();var makePager=function(){that.$element.find(".ch-pager").remove();var pager=$("<ul class=\"ch-pager\">");var thumbs=[];for(var i=1,j=totalPages+1;i<j;i+=1){if(i==1)thumbs.push("<li class=\"ch-pager-on\">");else thumbs.push("<li>");thumbs.push(i);thumbs.push("</li>");};pager.append(thumbs.join(""));that.$element.append(pager);var contextWidth=pager.parent().width();var pagerWidth=pager.outerWidth();pager.css('left',(contextWidth-pagerWidth)/2);pager.children().each(function(i,e){$(e).bind("click",function(){that.select(i+1);});});return pager;};var resize=false;that.buttons={prev:{$element:$('<p class="ch-prev"><span>Previous</span></p>').bind('click',function(){that.move("prev",1)}).css('top',(that.$element.outerHeight()-50+((conf.pager)?30:0))/2),on:function(){that.buttons.prev.$element.addClass("ch-prev-on")},off:function(){that.buttons.prev.$element.removeClass("ch-prev-on")}},next:{$element:$('<p class="ch-next"><span>Next</span></p>').bind('click',function(){that.move("next",1)}).css('top',(that.$element.outerHeight()-50+((conf.pager)?30:0))/2),on:function(){that.buttons.next.$element.addClass("ch-next-on")},off:function(){that.buttons.next.$element.removeClass("ch-next-on")}}};that.move=function(direction,distance){var movement;switch(direction){case"prev":if(that.active||(page-distance)<=0)return;page-=distance;movement=that.$content.position().left+(moveTo*distance);if(page==1)that.buttons.prev.off();that.buttons.next.on();break;case"next":if(that.active||(page+distance)>totalPages)return;page+=distance;movement=that.$content.position().left-(moveTo*distance);if(page==totalPages)that.buttons.next.off();that.buttons.prev.on();break;};that.active=true;var afterMove=function(){that.active=false;if(conf.pager){that.pager.children().removeClass("ch-pager-on");that.pager.children(":nth-child("+page+")").addClass("ch-pager-on");};that.callbacks("onMove");};if(ch.features.transition){that.$content.css({left:movement});afterMove();}else{that.$content.animate({left:movement},afterMove);};return that;};that.select=function(pageToGo){if(pageToGo>page){that.move("next",pageToGo-page);}else if(pageToGo<page){that.move("prev",page-pageToGo);};if(conf.pager){that.pager.children().removeClass("ch-pager-on");that.pager.children(":nth-child("+page+")").addClass("ch-pager-on");};return that;};that.redraw=function(){that.select(1);calculateMask();if(conf.pager)that.pager=makePager();};that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.getSteps=function(){return steps;};that.public.getPage=function(){return page;};that.public.moveTo=function(page){that.select(page);return that.public;};that.public.next=function(){that.move("next",1);return that.public;};that.public.prev=function(){that.move("prev",1);return that.public;};that.public.redraw=function(){that.redraw();return that.public;};that.$content.css('width',htmlContentWidth);that.$element.prepend(that.buttons.prev.$element).append(that.buttons.next.$element);if(htmlContentWidth>$mask.width())that.buttons.next.on();if(conf.pager){that.$element.addClass("ch-pager-bottom");that.pager=makePager();};if(!conf.hasOwnProperty("width")){ch.utils.window.bind("resize",function(){resize=true;});setInterval(function(){if(!resize)return;resize=false;that.redraw();},250);};return that;}
ch.dropdown=function(conf){var that=this;conf=ch.clon(conf);conf.skin=(that.$element.hasClass("secondary"))?"secondary":"primary";that.conf=conf;that=ch.navs.call(that);that.parent=ch.clon(that);that.$container=that.$element.addClass("ch-dropdown");that.$trigger=that.$container.children(":first");that.show=function(event){that.prevent(event);if(that.active){return that.hide(event);};$(ch.instances.dropdown).each(function(i,e){e.hide();});that.$content.css('z-index',ch.utils.zIndex++);that.$trigger.css('z-index',ch.utils.zIndex++);that.parent.show(event);that.position("refresh");if(conf.skin=="secondary"){that.$container.addClass("ch-dropdown-on");};ch.utils.document.one('click',function(event){that.hide(event)});return that;};that.hide=function(event){that.prevent(event);if(!that.active)return;if(conf.skin=="secondary"){that.$container.removeClass("ch-dropdown-on");};that.parent.hide(event);return that;};that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.show=function(){that.show();return that.public;};that.public.hide=function(){that.hide();return that.public;};that.public.position=that.position;that.$trigger.bind("click",function(event){that.show(event)}).addClass("ch-dropdown-trigger-"+conf.skin).append("<span class=\"ch-down\"> &raquo;</span>");that.$content=that.$trigger.next().addClass("ch-dropdown-content-"+conf.skin).addClass("ch-hide").bind("click",function(event){event.stopPropagation();}).detach();that.$content.find("a").one("click",function(){that.hide();});that.$container.after(that.$content);that.conf.position={};that.conf.position.element=that.$content;that.conf.position.context=that.$trigger;that.conf.position.points="lt lb";that.conf.position.offset="0 -1";ch.positioner.call(that);return that;};ch.layer=function(conf){var that=this;conf=ch.clon(conf);conf.cone=true;conf.classes="box";conf.position={};conf.position.context=that.$element;conf.position.offset=conf.offset||"0 10";conf.position.points=conf.points||"lt lb";that.conf=conf;that=ch.floats.call(that);that.parent=ch.clon(that);var showTime=conf.showTime||400;var hideTime=conf.hideTime||400;var st,ht;var showTimer=function(){st=setTimeout(that.show,showTime)};var hideTimer=function(){ht=setTimeout(that.hide,hideTime)};var clearTimers=function(){clearTimeout(st);clearTimeout(ht);};that.$trigger=that.$element;that.show=function(event){$.each(ch.instances.layer,function(i,e){e.hide();});that.parent.show(event);that.$container.bind('click',function(event){event.stopPropagation()});if(conf.event=="click"){$('<p class="btn close">x</p>').bind('click',that.hide).prependTo(that.$container);$(document).one('click',that.hide);}else{clearTimers();that.$container.one("mouseenter",clearTimers).bind("mouseleave",function(event){var target=event.srcElement||event.target;var relatedTarget=event.relatedTarget||event.toElement;var relatedParent=relatedTarget.parentNode;if(target===relatedTarget||relatedParent===null||target.nodeName==="SELECT")return;hideTimer();});};return that;};that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.content=that.content;that.public.show=function(){that.show();return that.public;};that.public.hide=function(){that.hide();return that.public;};that.public.position=that.position;if(conf.event==='click'){conf.closeButton=true;that.$trigger.css('cursor','pointer').bind('click',that.show);}else{that.$trigger.css('cursor','default').bind('mouseenter',that.show).bind('mouseleave',hideTimer);};$("body").bind(ch.events.CHANGE_LAYOUT,function(){that.position("refresh")});return that;};ch.modal=function(conf){var that=this;conf=ch.clon(conf);conf.ajax=(!conf.hasOwnProperty("ajax")&&!conf.hasOwnProperty("content")&&!conf.hasOwnProperty("msg"))?true:conf.ajax;conf.closeButton=(that.type=="modal")?true:false;conf.classes="box";that.conf=conf;that=ch.floats.call(that);that.parent=ch.clon(that);var $dimmer=$("<div>").addClass("ch-dimmer");var dimmer={on:function(){$dimmer.appendTo("body").css("z-index",ch.utils.zIndex++).fadeIn();if(that.type=="modal"){$dimmer.one("click",function(event){that.hide(event)});}},off:function(){$dimmer.fadeOut("normal",function(){$dimmer.detach();});}};that.$trigger=that.$element;that.show=function(event){dimmer.on();that.parent.show(event);that.$trigger.blur();return that;};that.hide=function(event){dimmer.off();that.parent.hide(event);return that;};that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.content=that.content;that.public.show=function(){that.show();return that.public;};that.public.hide=function(){that.hide();return that.public;};that.public.position=that.position;that.$trigger.css("cursor","pointer").bind("click",function(event){that.show(event);});return that;};ch.transition=function(conf){conf=conf||{};conf.closeButton=false;conf.msg=conf.msg||"Please wait...";conf.content=$("<div>").addClass("loading").append($("<p>").html(conf.msg));return ch.modal.call(this,conf);}
ch.factory({component:'transition'});ch.tabNavigator=function(conf){var that=this;that.$element.addClass('ch-tabNavigator');conf=ch.clon(conf);conf.selected=conf.selected||conf.value||0;that.conf=conf;that=ch.controllers.call(that);that.parent=ch.clon(that);var ul=that.$element.children(':first').addClass('ch-tabNavigator-triggers');var hash=window.location.hash.replace("#!","");var hashed=false;var selected=conf.selected;that.$trigger=ul.find('a');that.$content=ul.next().addClass('ch-tabNavigator-content box');that.select=function(tab){selected=parseInt(tab);tab=that.children[selected];if(tab.active)return;$.each(that.children,function(i,e){if(e.active)e.hide();});tab.shoot();window.location.hash="#!"+tab.$content.attr("id");that.callbacks("onSelect");return that;};that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.children=that.children;that.public.select=function(tab){that.select(tab);return that.public;};that.public.getSelected=function(){return selected;};$.each(that.$trigger,function(i,e){var tab={};tab.uid=that.uid+"#"+i;tab.type="tab";tab.element=e;tab.$element=$(e);that.children.push(ch.tab.call(tab,that));});for(var i=that.children.length;i--;){if(that.children[i].$content.attr("id")===hash){that.select(i);hashed=true;break;};};if(!hashed)that.children[conf.selected].shoot();return that;};ch.tab=function(controller){var that=this;conf={};if(controller.conf.hasOwnProperty("onContentLoad"))conf.onContentLoad=controller.conf.onContentLoad;if(controller.conf.hasOwnProperty("onContentError"))conf.onContentError=controller.conf.onContentError;that.conf=conf;that=ch.navs.call(that);that.parent=ch.clon(that);that.controller=controller;that.$trigger=that.$element.addClass("ch-tabNavigator-trigger");that.$content=(function(){var content=controller.$element.find("#"+that.element.href.split("#")[1]);if(content.length>0){return content;}else{conf.ajax=true;return $("<div>").attr("id","ch-tab"+that.uid).addClass("ch-hide").appendTo(controller.$content);};})();that.shoot=function(event){that.prevent(event);if(that.$content.html()=="")that.$content.html(that.loadContent());that.show(event);return that;};if(!that.active)that.$content.addClass("ch-hide");that.$trigger.bind('click',function(event){that.prevent(event);controller.select(that.uid.split("#")[1]);});return that;}
ch.tooltip=function(conf){var that=this;conf=ch.clon(conf);conf.cone=true;conf.content=that.element.title;conf.position={};conf.position.context=$(that.element);conf.position.offset=conf.offset||"0 10";conf.position.points=conf.points||"lt lb";that.conf=conf;that=ch.floats.call(that);that.parent=ch.clon(that);that.$trigger=that.$element;that.show=function(event){that.$trigger.attr('title','');that.parent.show(event);return that;};that.hide=function(event){that.$trigger.attr('title',conf.content);that.parent.hide(event);return that;};that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.content=that.content;that.public.show=function(){that.show();return that.public;};that.public.hide=function(){that.hide();return that.public;};that.public.position=that.position;that.$trigger.bind('mouseenter',that.show).bind('mouseleave',that.hide);$("body").bind(ch.events.CHANGE_LAYOUT,function(){that.position("refresh")});return that;};ch.string=function(conf){conf=conf||{};conf.messages=conf.messages||{};if(conf.hasOwnProperty("msg")){conf.messages.string=conf.msg;conf.msg=null;delete conf.msg;};if(!conf.text&&!conf.email&&!conf.url&&!conf.maxLength&&!conf.minLength){conf.text=true;};conf.types="text,email,url,minLength,maxLength";conf.conditions={text:{patt:/^([a-zA-Z\s]+)$/},email:{patt:/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/},url:{patt:/^((https?|ftp|file):\/\/|((www|ftp)\.)|(\/|.*\/)*)[a-z0-9-]+((\.|\/)[a-z0-9-]+)+([/?].*)?$/},minLength:{expr:function(a,b){return a>=b}},maxLength:{expr:function(a,b){return a<=b}}};return ch.watcher.call(this,conf);};ch.email=function(conf){conf=conf||{};conf.email=true;conf.messages={};if(conf.hasOwnProperty("msg")){conf.messages.email=conf.msg;conf.msg=null;delete conf.msg;};return ch.string.call(this,conf);};ch.factory({component:'email'});ch.url=function(conf){conf=conf||{};conf.url=true;conf.messages={};if(conf.hasOwnProperty("msg")){conf.messages.url=conf.msg;conf.msg=null;delete conf.msg;};return ch.string.call(this,conf);};ch.factory({component:'url'});ch.minLength=function(conf){conf=conf||{};conf.minLength=conf.value;conf.messages={};if(conf.hasOwnProperty("msg")){conf.messages.minLength=conf.msg;conf.msg=null;delete conf.msg;};return ch.string.call(this,conf);};ch.factory({component:'minLength'});ch.maxLength=function(conf){conf=conf||{};conf.maxLength=conf.value;conf.messages={};if(conf.hasOwnProperty("msg")){conf.messages.maxLength=conf.msg;conf.msg=null;delete conf.msg;};return ch.string.call(this,conf);};ch.factory({component:'maxLength'});ch.number=function(conf){conf=conf||{};conf.messages=conf.messages||{};if(conf.hasOwnProperty("msg")){conf.messages.number=conf.msg;conf.msg=null;delete conf.msg;};if(!conf.number&&!conf.min&&!conf.max&&!conf.price){conf.number=true;};conf.types="number,min,max,price";conf.conditions={number:{patt:/^([0-9\s]+)$/},min:{expr:function(a,b){return a>=b}},max:{expr:function(a,b){return a<=b}},price:{patt:/^(\d+)[.,]?(\d?\d?)$/}};return ch.watcher.call(this,conf);};ch.min=function(conf){conf=conf||{};conf.min=conf.value;conf.value=null;delete conf.value;conf.messages={};if(conf.hasOwnProperty("msg")){conf.messages.min=conf.msg;conf.msg=null;delete conf.msg;};return ch.number.call(this,conf);};ch.factory({component:'min'});ch.max=function(conf){conf=conf||{};conf.max=conf.value;conf.value=null;delete conf.value;conf.messages={};if(conf.hasOwnProperty("msg")){conf.messages.max=conf.msg;conf.msg=null;delete conf.msg;};return ch.number.call(this,conf);}
ch.factory({component:'max'});ch.price=function(conf){conf=conf||{};conf.price=true;conf.value=null;delete conf.value;conf.messages={};if(conf.hasOwnProperty("msg")){conf.messages.price=conf.msg;conf.msg=null;delete conf.msg;};return ch.number.call(this,conf);}
ch.factory({component:'price'});ch.custom=function(conf){if(!conf.lambda){alert("Custom Validation fatal error: Need a function to evaluate, try $().custom(function(){},\"Message\");");};conf=conf||{};conf.messages=conf.messages||{};if(conf.hasOwnProperty("msg")){conf.messages.custom=conf.msg;conf.msg=null;delete conf.msg;};conf.custom=true;conf.types="custom";conf.conditions={custom:{func:conf.lambda}};return ch.watcher.call(this,conf);};ch.required=function(conf){conf=conf||{};conf.messages={};if(conf.hasOwnProperty("msg")){conf.messages.required=conf.msg;conf.msg=null;delete conf.msg;};conf.required=true;conf.types="required";conf.conditions={required:'that.isEmpty'};return ch.watcher.call(this,conf);};ch.helper=function(controller){var that=this;var conf={};conf.cone=true;conf.position={};conf.position.context=controller.reference;conf.position.offset="15 0";conf.position.points="lt rt";conf.cache=false;that.conf=conf;that=ch.floats.call(that);that.parent=ch.clon(that);that.$trigger=that.$element;that.show=function(text){if(!that.active){conf.content='<p><span class="ico error">Error: </span>'+text+'</p>';that.parent.show();}else{that.$content.html('<p><span class="ico error">Error: </span>'+text+'</p>');};return that;};that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.content=that.content;that.public.show=function(text){that.show(text);return that.public;};that.public.hide=function(){that.hide();return that.public;};that.public.position=that.position;$("body").bind(ch.events.CHANGE_LAYOUT,function(){that.position("refresh");});return that;};ch.form=function(conf){if(this.$element.find(":submit").length==0||this.$element.attr("action")==""){alert("Form fatal error: The <input type=submit> is missing, or need to define a action attribute on the form tag.");return;};if(ch.instances.hasOwnProperty("form")&&ch.instances.form.length>0){for(var i=0,j=ch.instances.form.length;i<j;i++){if(ch.instances.form[i].element===this.element){return{exists:true,object:ch.instances.form[i]};};};};var that=this;conf=ch.clon(conf);if(!conf.hasOwnProperty("messages"))conf.messages={};conf.messages["general"]=conf.messages["general"]||"Check for errors.";that.$element.attr("novalidate","novalidate");that.conf=conf;that=ch.controllers.call(that);that.parent=ch.clon(that);var status=true;var $error=$("<p class=\"ch-validator\"><span class=\"ico error\">Error: </span>"+conf.messages["general"]+"</p>");var createError=function(){that.$element.before($error);$("body").trigger(ch.events.CHANGE_LAYOUT);};var removeError=function(){$error.detach();$("body").trigger(ch.events.CHANGE_LAYOUT);};var checkStatus=function(){for(var i=0,j=that.children.length;i<j;i++){if(that.children[i].active()){if(!status)removeError();createError();status=false;return;};};if(!status){removeError();status=true;};};var validate=function(){that.callbacks("beforeValidate");for(var i=0,j=that.children.length;i<j;i++){that.children[i].validate();if(i==0)that.children[i].element.focus();};checkStatus();status?that.callbacks("onValidate"):that.callbacks("onError");that.callbacks("afterValidate");return that;};var submit=function(event){that.prevent(event);that.callbacks("beforeSubmit");validate();if(status){if(!conf.hasOwnProperty("onSubmit")){that.element.submit();}else{that.callbacks("onSubmit");};};that.callbacks("afterSubmit");return that;};var clear=function(event){that.prevent(event);removeError();for(var i=0,j=that.children.length;i<j;i++)that.children[i].reset();that.callbacks("onClear");return that;};var reset=function(event){clear();that.element.reset();that.callbacks("onReset");return that;};that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.children=that.children;that.public.messages=conf.messages;that.public.validate=function(){validate();return that.public;};that.public.submit=function(){submit();return that.public;};that.public.checkStatus=function(){checkStatus();return that.public;};that.public.getStatus=function(){return status;};that.public.clear=function(){clear();return that.public;};that.public.reset=function(){reset();return that.public;};that.$element.bind("submit",function(event){submit(event);});that.$element.find(":reset, .resetForm").bind("click",function(event){clear(event);});return that;};ch.viewer=function(conf){var that=this;conf=ch.clon(conf);that.conf=conf;that=ch.controllers.call(that);that.parent=ch.clon(that);var $viewer=that.$element.addClass("ch-viewer");var showcase=(function(){var lens=$("<div>").addClass("ch-lens ch-hide").bind("click",function(){viewerModal.show();});var display=$viewer.children(":first").addClass("ch-viewer-content");display.find("img, object, embed, video").bind("mouseover",function(){lens.fadeIn();}).bind("mouseleave",function(){lens.fadeOut();});var wrapper=$("<div>").addClass("ch-viewer-display").append(display).append(lens).appendTo($viewer);var self={};self.items=display.children();self.itemsWidth=self.items.outerWidth();self.itemsAmount=self.items.length;self.itemsAnchor=self.items.children("a").bind("click",function(event){that.prevent(event);viewerModal.show();});self.display=display.css("width",(self.itemsAmount*self.itemsWidth)+(ch.utils.html.hasClass("ie6")?self.itemsWidth:0));ch.positioner({element:lens,context:wrapper});return self;})();var createThumbs=function(){var structure=$("<ul>").addClass("carousel");$.each(showcase.items,function(i,e){var thumb=$("<li>").bind("click",function(event){that.prevent(event);that.move(i+1);});if($(e).children("link[rel=thumb]").length>0){$("<img>").attr("src",$(e).children("link[rel=thumb]").attr("href")).appendTo(thumb);}else if($(e).children("object").length>0||$(e).children("embed").length>0){$("<span>").html("Video").appendTo(thumb.addClass("ch-viewer-video"));};structure.append(thumb);});var self={};self.children=structure.children();self.selected=1;self.carousel=that.children[0]=$("<div>").addClass("ch-viewer-triggers").append(structure).appendTo($viewer).carousel({width:$viewer.width()});return self;};var viewerModal=that.children[1]=$("<div>").modal({content:"<div class=\"ch-viewer-modal-content\"></div>",width:600,onShow:function(){var modalContent=$(".ch-viewer-modal-content");modalContent.parents(".ch-modal").addClass("ch-viewer-modal");var list=$("<ul>");var bigId=0;$.each(showcase.items,function(i,e){var item={};if($(e).children("a").length>0){item=$("<img>").attr("src",bigImages[bigId++]);}else if($(e).children("object").length>0){var resize={"width":500,"height":500};var video=$(e).children("object")[0].cloneNode(true);item=$(video).attr(resize).children("embed").attr(resize);}else if($(e).children("embed").length>0){var video=$(e).children("embed")[0].cloneNode(true);item=$(video).attr({"width":500,"height":500});};$("<li>").append(item).appendTo(list);});list.addClass("carousel").css("left",0).appendTo(modalContent);if(showcase.itemsAmount>1){that.children[2]=modalContent.carousel({pager:true}).moveTo(thumbnails.selected);}else{modalContent.wrapInner("<div class=\"ch-viewer-oneItem\">");};checkZoomImages(modalContent);this.position("refresh");},onHide:function(){$(".ch-viewer-modal-content").html("").removeClass("ch-carousel");if(showcase.itemsAmount>1){that.move(that.children[2].getPage());for(var i=0,j=ch.instances.carousel.length;i<j;i+=1){if(ch.instances.carousel[i].element===that.children[2].element){ch.instances.carousel.splice(i,1);return;};};};}});var checkZoomImages=function(modal){var zoomImages=[];$.each(showcase.items,function(i,e){var src=$(e).children("link[rel=zoom]").attr("href");if(!src)return;var image=$("<img>").attr("src",src).addClass("ch-viewer-zoomed").bind("click",function(){$(this).fadeOut();}).bind("mousemove",function(event){zoomMove(event);}).appendTo((showcase.itemsAmount>1)?modal:modal.children()).hide();var zoomMove=function(event){var offset=modal.offset();var diff={x:image.outerWidth()/modal.outerWidth()-1,y:image.outerHeight()/modal.outerHeight()-1};image.css({left:-(event.pageX-offset.left)*diff.x+"px",top:-(event.pageY-offset.top)*diff.y+"px"});};var zoomable=$("<a>").attr("href",src).addClass("ch-viewer-zoomable").bind("click",function(event){that.prevent(event);zoomMove(event);image.fadeIn();});modal.find(".ch-carousel-content li").eq(i).wrapInner(zoomable);zoomImages.push(src);});if(zoomImages.length>0)ch.preload(zoomImages);};var move=function(item){if(item>showcase.itemsAmount||item<1||isNaN(item))return that;var visibles=thumbnails.carousel.getSteps();var page=thumbnails.carousel.getPage();var nextPage=Math.ceil(item/visibles);$(thumbnails.children[thumbnails.selected-1]).removeClass("ch-thumbnail-on");$(thumbnails.children[item-1]).addClass("ch-thumbnail-on");var movement={left:(-item+1)*showcase.itemsWidth};if(ch.features.transition)showcase.display.css(movement);else showcase.display.animate(movement);if(page!=nextPage)thumbnails.carousel.moveTo(nextPage);thumbnails.selected=item;that.callbacks("onMove");return that;};that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.children=that.children;if(showcase.itemsAmount>1){that.public.moveTo=function(item){that.move(item);return that.public;};that.public.next=function(){that.move(thumbnails.selected+1);return that.public;};that.public.prev=function(){that.move(thumbnails.selected-1);return that.public;};that.public.getSelected=function(){return thumbnails.selected;};var thumbnails=createThumbs();that.move=move;that.move(1);};var bigImages=[];$(function(){showcase.itemsAnchor.each(function(i,e){bigImages.push($(e).attr("href"));});ch.preload(bigImages);});return that;};ch.chat=function(conf){var that=ch.object();var getDomain=function(n){switch(n){case"1":return"mercadolidesa.com.ar";break;case"2":return"mercadolistage.com.ar";break;case"3":return"mercadolibre.com.ar";break;}}
if(conf.msg){conf.ruleGroupName=conf.msg;}
that.load=function(){loadChatGZ(conf.ruleGroupName,conf.element.id,conf.style||"block",conf.template||"1",conf.environment||"3");}
ch.get({method:"component",name:"chat",script:"http://www."+getDomain(conf.environment)+"/org-img/jsapi/chat/chatRBIScript.js",callback:function(){that.load();}});that.publish={uid:conf.uid,element:conf.element,type:conf.type}
return that.publish;}
ch.expando=function(conf){var that=this;that.$element.addClass("ch-expando").children(":first").wrapInner("<span class=\"ch-expando-trigger\"></span>");conf=ch.clon(conf);conf.open=conf.open||false;that.conf=conf;that=ch.navs.call(that);that.parent=ch.clon(that);that.$content=that.$element.children().eq(1);that.$trigger=that.$element.find(".ch-expando-trigger");that.show=function(event){that.prevent(event);if(that.active){return that.hide(event);};that.parent.show(event);return that;};that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.show=function(){that.show();return that.public;};that.public.hide=function(){that.hide();return that.public;};that.$trigger.bind('click',function(event){that.show(event);}).addClass('ch-expando-trigger');that.$content.addClass('ch-expando-content');if(conf.open)that.show();conf.publish=that.publish;return that;};ch.codelighter=function(){var that=this;that=ch.controllers.call(that);that.parent=ch.clon(that);that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.children=that.children;$("pre[name=code]").each(function(i,e){var codesnippet={};codesnippet.uid=ch.utils.index+=1;codesnippet.type="codesnippet";codesnippet.element=e;codesnippet.snippet=e.innerHTML;that.children.push(ch["code"+e.className.toUpperCase()].call(codesnippet));});ch.instances.codelighter=that.children;return that;};ch.codesnippet=function(conf){var that=this;conf=ch.clon(conf);that.conf=conf;that=ch.object.call(that);that.parent=ch.clon(that);var paint=function(){for(var x in conf.brush){if(conf.brush[x].test(that.paintedSnippet)){that.paintedSnippet=that.paintedSnippet.replace(conf.brush[x],x);};};return that.paintedSnippet;};that.paintedSnippet=that.snippet;that.public={};that.public.uid=that.uid;that.public.type=conf.type;that.public.element=that.element;that.public.snippet=that.snippet;that.public.paintedSnippet=that.paintedSnippet;that.element.innerHTML=paint();return that;};ch.codeXML=function(conf){conf=conf||{};conf.type="codeXML";conf.brush={"&lt;":/</g,"&gt;":/>/g,"<span class='ch-comment'>$&</span>":/(\&lt;|&lt;)!--\s*.*?\s*--(\&gt;|&gt;)/g,"<span class='ch-attrName'>$&</span>":/(id|name|class|title|alt|value|type|style|method|href|action|lang|dir|src|tabindex|usemap|data|rel|charset|encoding|size|selected|checked|placeholder|target|required|disabled|max|min|maxlength|accesskey)=".*"/g,"<span class='ch-attrValue'>$&</span>":/".+?"/g,"<span class='ch-tag'>$&</span>":/(&lt;([a-z]|\/).*?&gt;)/g,"    ":/\t/g};this.snippet=this.snippet||this.element.innerHTML;return ch.codesnippet.call(this,conf);};ch.factory({component:'codeXML'});ch.codeJS=function(conf){conf=conf||{};conf.type="codeJS";conf.brush={"$1 $2 $3":/(<)([a-z]|\/|.*?)(>)/g,"<span class='ch-operator'>$&</span>":/(\+|\-|=|\*|&|\||\%|\!|\?)/g,">":/>amp;/g,"<span class='ch-atom'>$&</span>":/(false|null|true|undefined)/g,"$1<span class='ch-keywords'>$2</span>$3":/(^|\s|\(|\{)(return|new|delete|throw|else|case|break|case|catch|const|continue|default|delete|do|else|finally|for|function|if|in|instanceof|new|switch|throw|try|typeof|var|void|while|with)(\s*)/g,"<span class='ch-attrValue'>$&</span>":/(".+?")|[0-9]/g,"    ":/\t/g,"<span class='ch-comment'>$&</span>":/(\/\*)\s*.*\s*(\*\/)/g,"<span class='ch-comment'>$&</span>":/(\/\/)\s*.*\s*\n*/g};this.snippet=this.snippet||this.element.innerHTML;return ch.codesnippet.call(this,conf);};ch.factory({component:'codeJS'});ch.codeCSS=function(conf){conf=conf||{};conf.type="codeCSS";conf.brush={"<span class='ch-comment'>$&</span>":/(\/\*)\s*.*\s*(\*\/)/g,"<span class='ch-attrName'>$&</span>":/(\w)\s*:".*"/g,"<span class='ch-selector'>$1$2</span>$3":/(#|\.)(\w+)({)/g,"$1<span class='ch-property'>$2</span>$3":/({|;|\s)(\w*-*\w*)(\s*:)/g,"$1<span class='ch-attrValue'>$2</span>$3":/(:)(.+?)(;)/g,"    ":/\t/g};this.snippet=this.snippet||this.element.innerHTML;return ch.codesnippet.call(this,conf);};ch.factory({component:'codeCSS'});ch.accordion=function(conf){var that=this;that.$element.addClass('ch-accordion');conf=ch.clon(conf);that.conf=conf;that=ch.controllers.call(that);that.parent=ch.clon(that);that.public.uid=that.uid;that.public.element=that.element;that.public.type=that.type;that.public.children=that.children;that.public.select=function(bellows){if(typeof bellows=="string"){var sliced=bellows.split("#");that.children[sliced[0]].select(sliced[1]);}else{that.children[bellows].show();};that.callbacks("onSelect");return that.public;};$.each(that.$element.children(),function(i,e){if($(e).children().eq(1).attr("tagName")!="UL"){that.children.push($(e).addClass("ch-bellows").children().addClass("ch-bellows-trigger"));return;};var list={};list.uid=that.uid+"#"+i;list.type="bellows";list.element=e;list.$element=$(e);if(conf.hasOwnProperty("selected")){list.open=(typeof conf.selected=="number")?conf.selected==i:(conf.selected.split("#")[0]==i)?conf.selected.split("#")[1]:false;}else{list.open=false;};that.children.push(ch.bellows.call(list,that));});return that;};ch.bellows=function(controller){var that=this;conf={};that.conf=conf;that=ch.navs.call(that);that.parent=ch.clon(that);that.controller=controller;that.$container=that.$element.addClass("ch-bellows");that.$trigger=that.$container.children(":first");that.$content=that.$trigger.next();that.show=function(event){that.prevent(event);if(that.active)return that.hide(event);if(!controller.conf.menu){$.each(controller.children,function(i,e){if(e.hasOwnProperty("active")&&e.active==true&&e.element!==that.element)e.hide();});};if(!ch.utils.html.hasClass("ie6"))that.$content.slideDown("fast");that.parent.show(event);return that;};that.hide=function(event){that.prevent(event);if(!that.active)return;that.active=false;that.parent.hide(event);that.$content.slideUp("fast");that.$trigger.removeClass("ch-"+that.type+"-on");if(!ch.utils.html.hasClass("ie6"))that.$content.slideUp("fast");that.callbacks("onHide");return that;};that.select=function(child){that.show();that.$content.find("a").eq(child).addClass("ch-bellows-on");};if(that.open)that.select(parseInt(that.open));else that.$content.addClass("ch-hide");that.$trigger.addClass("ch-bellows-trigger").bind("click",function(event){that.show(event)}).append("<span class=\"ch-arrow\"> &raquo;</span>");that.$content.addClass("ch-bellows-content").bind("click",function(event){event.stopPropagation();});return that;};ch.menu=function(conf){conf=conf||{};conf.menu=true;return ch.accordion.call(this,conf);};ch.factory({component:'menu'});
ch.init();
})(jQuery);